---json
{
  "eleventyExcludeFromCollections": true
}
---
{#
  Outputs an Atom feed
  Key properties
  - collectioName: string
  - title: defaults to site.title
  - description: defaults to site.description
  - url: path of HTML file that this feed represents defaults to root
#}
{%- set feedCollection = (collections[collectionName] | reverse).slice(0,31) -%}
<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet href="/assets/feed.xsl" type="text/xsl"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>{{ title | default(site.title) }}</title>
  <subtitle>{{ description | default(site.description) }}</subtitle>
  <link href="{{ page.url | replace(" ", "%20") | addBaseUrl }}" rel="self" type="application/atom+xml" />
  <link href="{{ url | default ("/") | replace(" ", "%20") | addBaseUrl }}" rel="alternate" type="text/html" />
  <updated>{{ feedCollection | getNewestCollectionItemDate | dateToRfc3339 }}</updated>
  <id>{{  url | default ("/") | replace(" ", "%20") | addBaseUrl }}</id>
  <author>
    <name>Anthony Ciccarello</name>
    <email>{{ site.email }}</email>
  </author>
  {%- for post in feedCollection %}
  {%- set absolutePostUrl %}{{ post.url | url | addBaseUrl }}{% endset %}
  {%- set postImage %}{% if post.data.image -%}
      <figure>
        <img src="{{ post.data.image }}" alt="{{ post.data.image_alt | escape }}" />
        {%- if image_caption %}
        <figcaption class="mdc-typography--caption">
          {{ post.data.image_caption | markdownify }}
        </figcaption>
        {%- endif %}
      </figure>
  {%- endif %}{% endset %}
  <entry>
    <title>{{ post.data.title or post.data.defaultTitle }}</title>
    <link href="{{ absolutePostUrl }}"/>
    <updated>{{ post.date | dateToRfc3339 }}</updated>
    <id>{{ absolutePostUrl }}</id>
    {%- for tag in post.data.tags %}
    <category term="{{ tag }}"/>
    {%- endfor %}
    {%- if loop.index <= 10 %}
    <content type="html">
      {{ postImage | htmlToAbsoluteUrls(absolutePostUrl) }}
      {{ post.templateContent | sanitizeFeedContent | htmlToAbsoluteUrls(absolutePostUrl) }}
    </content>
    {%- else %}
    <summary type="html">
      {{ postImage | htmlToAbsoluteUrls(absolutePostUrl) }}
      {%- set contentSummary %}
      <p>{{ post.templateContent | striptags | truncate(500) }}</p>
      <a href="{{ absolutePostUrl }}">Read More</a>
      {% endset %}
      {{ contentSummary }}
    </summary>
    {%- endif %}
  </entry>
  {%- endfor %}
</feed>
